var x = d3.scaleLinear()
		.domain([0, 5100])
		.range([0, 480])

	var xAxis = d3.axisBottom(x)
		.tickSize(13)
		.tickValues(color.domain())
		.tickFormat(function(d) { return d >= 100 ? formatNumber(d) : null; });

	var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", height);

	var g = svg.append("g")
		.attr("class", "key")
		.attr("transform", "translate(250,40)")
		.attr("align","center");;

	g.selectAll("rect")
		.data(color.range().map(function(d, i) {
		  return {
			x0: i ? x(color.domain()[i - 1]) : x.range()[0],
			x1: i < color.domain().length ? x(color.domain()[i]) : x.range()[1],
			z: d
		  };
		}))
	  .enter().append("rect")
		.attr("height", 8)
		.attr("x", function(d) { return d.x0; })
		.attr("width", function(d) { return d.x1 - d.x0; })
		.style("fill", function(d) { return d.z; });

	g.append("text")
		.attr("class", "caption")
		.attr("x", x.range()[0])
		.attr("y", -6)
		.attr("fill", "#000")
		.attr("text-anchor", "start")
		.attr("font-weight", "bold")
		.text("Population per square mile");

	g.call(xAxis).append("text")
		.attr("class", "caption")
		.attr("y", -6)
		.text("Population per square mile");

	d3.json("il.json", function(error, il) {
		if (error) throw error;
		console.log(il.objects);
		svg.append("g")
			.selectAll("path")
			.data(topojson.feature(il, il.objects.tracts).features)
			.enter().append("path")
			.attr("fill", function(d) { return color(d.properties.density); })
			.attr("d", path)
			.attr("transform", "translate(0,80)");

		svg.append("path")
			.datum(topojson.feature(il, il.objects.counties))
			.attr("fill", "none")
			.attr("stroke", "#000")
			.attr("stroke-opacity", 0.3)
			.attr("d", path)
			.attr("transform", "translate(0,80)");
	});